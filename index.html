/* Data and Logic */
let user = "", curLvl = "", qIdx = 0, currentQuestions = [], wins = 0;

const glossaryData = [
    { category: "Space", fact: "Light from the Sun takes 8 minutes and 20 seconds to reach Earth." },
    { category: "Space", fact: "The universe has no center and is constantly expanding." },
    { category: "Space", fact: "A spoonful of a neutron star would weigh about 6 billion tons." },
    { category: "Space", fact: "Venus is the hottest planet in our solar system, not Mercury." },
    { category: "Space", fact: "Saturn's rings are made of 99.9% pure water ice." },
    { category: "Space", fact: "Footprints on the Moon will stay there for 100 million years." },
    { category: "Space", fact: "Sound does not travel in the vacuum of space." },
    { category: "Space", fact: "Jupiter is twice as massive as all other planets combined." },
    { category: "Space", fact: "There are more stars in the universe than grains of sand on Earth." },
    { category: "Space", fact: "Astronauts can grow up to 2 inches taller in space." },
    { category: "Biology", fact: "The human brain operates on about 20 watts of power." },
    { category: "Biology", fact: "Your heart beats about 100,000 times a day." },
    { category: "Biology", fact: "Humans share about 60% of their DNA with bananas." },
    { category: "Biology", fact: "The strongest muscle in the human body is the jaw muscle." },
    { category: "Biology", fact: "Fingernails grow nearly 4x faster than toenails." },
    { category: "Biology", fact: "An adult human has 206 bones; a baby has around 300." },
    { category: "Biology", fact: "The human eye can distinguish 10 million colors." },
    { category: "Biology", fact: "Your stomach gets a new lining every 3 to 4 days." },
    { category: "Biology", fact: "A blood cell takes 60 seconds to circuit the body." },
    { category: "Biology", fact: "Smallpox is the only human disease completely eradicated." },
    { category: "Nature", fact: "Octopus have three hearts and blue blood." },
    { category: "Nature", fact: "A snail can sleep for three years." },
    { category: "Nature", fact: "Polar bears have black skin under their white fur." },
    { category: "Nature", fact: "Honey never spoils; it can last for thousands of years." },
    { category: "Nature", fact: "Cows have 'best friends' and get stressed when separated." },
    { category: "Nature", fact: "Butterflies taste with their feet." },
    { category: "Nature", fact: "A shrimp's heart is located in its head." },
    { category: "Nature", fact: "Seahorses are the only fish where the male gives birth." },
    { category: "Nature", fact: "Wombat poop is cube-shaped." },
    { category: "Nature", fact: "Ants breathe through tiny holes called spiracles." },
    { category: "Chemistry", fact: "Oxygen is actually a pale blue color in its liquid state." },
    { category: "Chemistry", fact: "The only letter not found on the periodic table is J." },
    { category: "Chemistry", fact: "20% of Earth's oxygen is produced by the Amazon." },
    { category: "Chemistry", fact: "Helium is the only element that cannot be solidified by cooling alone." },
    { category: "Chemistry", fact: "Water expands as it freezes, which is why ice floats." },
    { category: "Chemistry", fact: "Diamond and graphite are both made entirely of carbon." },
    { category: "Earth", fact: "The Earth's core is as hot as the surface of the Sun." },
    { category: "Earth", fact: "Lightning strikes the Earth about 100 times every second." },
    { category: "Chemistry", fact: "Hydrofluoric acid is so corrosive it can dissolve glass." },
    { category: "Chemistry", fact: "Gold is so rare, more steel is poured in an hour than gold in history." },
    { category: "Physics", fact: "Glass is a 'disordered solid' rather than a true liquid." },
    { category: "Nature", fact: "Bananas are slightly radioactive (due to potassium)." },
    { category: "Biology", fact: "DNA was first discovered in 1869 by Friedrich Miescher." },
    { category: "Biology", fact: "Average person walks 5x around the world in a lifetime." },
    { category: "Physics", fact: "Hot water can freeze faster than cold water (Mpemba effect)." },
    { category: "Nature", fact: "Rats can laugh when tickled." },
    { category: "Physics", fact: "Every atom in your body is billions of years old." },
    { category: "Physics", fact: "99% of an atom is empty space." },
    { category: "General", fact: "If you fold paper 42 times, it would reach the Moon." },
    { category: "Earth", fact: "Hawaii moves 7.5cm closer to Alaska every year." }
];

/* Original Quiz Data */
const quizData = {
    Pro: [{q:"Chemical formula for water?", a:"H2O", o:["CO2","HO2","NaCl"]},{q:"Red Planet?", a:"Mars", o:["Venus","Jupiter","Earth"]},{q:"Hardest natural substance?", a:"Diamond", o:["Gold","Steel","Quartz"]},{q:"Boiling point of water?", a:"100°C", o:["90°C","120°C","80°C"]},{q:"Gas we breathe in?", a:"Oxygen", o:["Nitrogen","Carbon","Helium"]},{q:"Planets in Solar System?", a:"8", o:["9","7","10"]},{q:"Powerhouse of cell?", a:"Mitochondria", o:["Nucleus","Ribosome","DNA"]},{q:"Largest ocean?", a:"Pacific", o:["Atlantic","Indian","Arctic"]},{q:"Symbol for Gold?", a:"Au", o:["Ag","Go","Fe"]},{q:"Largest land animal?", a:"Elephant", o:["Rhino","Giraffe","Hippo"]}],
    Master: [{q:"Absolute Zero value?", a:"-273.15°C", o:["0°C","-100°C","-300°C"]},{q:"78% of air is?", a:"Nitrogen", o:["Oxygen","CO2","Argon"]},{q:"Bones in adult body?", a:"206", o:["200","210","300"]},{q:"Light speed per sec?", a:"300,000 km/s", o:["150,000 km/s","10,000 km/s","500,000 km/s"]},{q:"Atomic number of Oxygen?", a:"8", o:["6","10","1"]},{q:"Liquid metal?", a:"Mercury", o:["Lead","Gallium","Silver"]},{q:"Discovered Penicillin?", a:"Fleming", o:["Pasteur","Curie","Newton"]},{q:"pH of pure water?", a:"7", o:["1","14","9"]},{q:"Center of atom?", a:"Nucleus", o:["Proton","Neutron","Shell"]},{q:"Unit of resistance?", a:"Ohm", o:["Volt","Amp","Watt"]}],
    Elite: [{q:"Symbol 'Fe' is?", a:"Iron", o:["Fluorine","Silver","Lead"]},{q:"Most moons?", a:"Saturn", o:["Jupiter","Uranus","Neptune"]},{q:"Abundant metal in crust?", a:"Aluminum", o:["Iron","Steel","Gold"]},{q:"Neutron charge?", a:"Neutral", o:["Positive","Negative","Variable"]},{q:"Study of fungi?", a:"Mycology", o:["Biology","Zoology","Botany"]},{q:"Deepest ocean point?", a:"Mariana Trench", o:["Java Trench","Arctic Basin","Dead Sea"]},{q:"Plants absorb what gas?", a:"Carbon Dioxide", o:["Oxygen","Nitrogen","Ozone"]},{q:"Newton's 1st Law?", a:"Inertia", o:["Gravity","Friction","Momentum"]},{q:"Glass component?", a:"Silica", o:["Sodium","Calcium","Carbon"]},{q:"Flies backwards?", a:"Hummingbird", o:["Sparrow","Eagle","Parrot"]}],
    Ruby: [{q:"Rarest blood type?", a:"AB Negative", o:["O Negative","A Positive","B Negative"]},{q:"Golden Ratio?", a:"1.618", o:["3.141","2.718","1.414"]},{q:"Rotates on its side?", a:"Uranus", o:["Neptune","Saturn","Jupiter"]},{q:"Adjusts light in eye?", a:"Iris", o:["Retina","Lens","Pupil"]},{q:"Polio vaccine creator?", a:"Salk", o:["Sabin","Lister","Jenner"]},{q:"Old thermometer element?", a:"Mercury", o:["Alcohol","Silver","Water"]},{q:"Lowest atmosphere layer?", a:"Troposphere", o:["Stratosphere","Mesosphere","Exosphere"]},{q:"Adult teeth count?", a:"32", o:["28","30","36"]},{q:"Symbol for Potassium?", a:"K", o:["P","Po","Ka"]},{q:"Periodic table elements?", a:"118", o:["115","120","100"]}],
    Emerald: [{q:"Speed of sound?", a:"343 m/s", o:["299 m/s","500 m/s","100 m/s"]},{q:"Gas to liquid process?", a:"Condensation", o:["Evaporation","Sublimation","Melting"]},{q:"Vitamin for clotting?", a:"Vitamin K", o:["Vitamin C","Vitamin D","Vitamin A"]},{q:"Largest organ?", a:"Skin", o:["Liver","Lungs","Brain"]},{q:"Frequency unit?", a:"Hertz", o:["Decibels","Watts","Ohms"]},{q:"Water molar mass?", a:"18.015 g/mol", o:["1.008 g/mol","16.00 g/mol","12.01 g/mol"]},{q:"Light bulb gas?", a:"Argon", o:["Neon","Oxygen","Hydrogen"]},{q:"Densest planet?", a:"Earth", o:["Jupiter","Mars","Saturn"]},{q:"Spider legs?", a:"8", o:["6","10","12"]},{q:"Photosynthesis pigment?", a:"Chlorophyll", o:["Carotene","Melanin","Hemoglobin"]}],
    Gold: [{q:"Abundant gas in universe?", a:"Hydrogen", o:["Helium","Oxygen","Nitrogen"]},{q:"Electron charge?", a:"Negative", o:["Positive","Neutral","Proton"]},{q:"Great Red Spot planet?", a:"Jupiter", o:["Mars","Saturn","Venus"]},{q:"Carbon-14 half-life?", a:"5730 years", o:["1000 years","10000 years","500 years"]},{q:"Cell division for growth?", a:"Mitosis", o:["Meiosis","Osmosis","Diffusion"]},{q:"Acid in lemons?", a:"Citric Acid", o:["Acetic Acid","Lactic Acid","Nitric Acid"]},{q:"Largest hot desert?", a:"Sahara", o:["Gobi","Kalahari","Atacama"]},{q:"Unit of power?", a:"Watt", o:["Joule","Newton","Volt"]},{q:"Smallest unit of life?", a:"Cell", o:["Atom","Molecule","Organelle"]},{q:"Father of Genetics?", a:"Mendel", o:["Darwin","Linnaeus","Watson"]}],
};

function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }

function handleLogin() {
    const inp = document.getElementById('username-input'); if(!inp.value) return;
    user = inp.value.trim().toUpperCase();
    document.getElementById('id-val').innerText = user; document.getElementById('cert-name').innerText = user;
    document.getElementById('login-screen').style.display = 'none';
    addAI("SkiLabs Online. User: " + user, 'ai-bub');
    renderGlossary(); // Load the facts after login
}

function renderGlossary() {
    const list = document.getElementById('glos-list');
    list.innerHTML = "";
    glossaryData.forEach(item => {
        const div = document.createElement('div');
        div.className = "glass-panel";
        div.style.marginBottom = "10px";
        div.style.padding = "15px";
        div.innerHTML = `<small style="color:var(--primary); font-weight:bold;">${item.category}</small>
                         <p style="margin:5px 0 0 0; font-size:0.95rem;">${item.fact}</p>`;
        list.appendChild(div);
    });
}

function nav(id, btn) {
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active-view'));
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(id).classList.add('active-view');
    btn.classList.add('active'); if(window.innerWidth <= 768) toggleSidebar(); 
}

function toggleAI() { const w = document.getElementById('ai-window'); w.style.display = w.style.display === 'flex' ? 'none' : 'flex'; }

function prepareQuiz(lvl) {
    curLvl = lvl; qIdx = 0; currentQuestions = quizData[lvl];
    document.getElementById('quiz-menu').style.display = 'none'; document.getElementById('quiz-active').style.display = 'block';
    showQ();
}

function showQ() {
    const d = currentQuestions[qIdx]; document.getElementById('q-lvl').innerText = curLvl.toUpperCase();
    document.getElementById('q-num').innerText = `${qIdx+1}/${currentQuestions.length}`;
    document.getElementById('q-txt').innerText = d.q;
    const box = document.getElementById('q-opts'); box.innerHTML = "";
    [d.a, ...d.o].sort(() => Math.random() - 0.5).forEach(o => {
        const b = document.createElement('button'); b.className="quiz-opt"; b.innerText=o;
        b.onclick = () => { if(o === d.a){ qIdx++; if(qIdx < currentQuestions.length) showQ(); else finishQuiz(); } else { b.classList.add('error-shake'); setTimeout(()=>b.classList.remove('error-shake'),400); } };
        box.appendChild(b);
    });
}

function finishQuiz() {
    wins++; document.getElementById('quiz-active').style.display='none'; document.getElementById('quiz-menu').style.display='block';
    document.getElementById('rank-val').innerText = curLvl.toUpperCase();
    document.getElementById('prog-bar').style.width = (wins * 16.6) + "%";
    document.getElementById('badge-' + curLvl.toLowerCase()).classList.add('unlocked');
    if(curLvl === 'Elite') { document.body.classList.add('gold-theme'); document.getElementById('adv-box').style.display='block'; }
    if(curLvl === 'Gold') { unlockMaster(); }
    confetti({ origin: { y: 0.7 } }); setTimeout(() => nav('dash', document.getElementById('nav-dash')), 1000);
}

function unlockMaster() {
    wins = 6; document.body.classList.add('gold-theme'); document.getElementById('rank-val').innerText = "GOLD MASTER";
    document.getElementById('prog-bar').style.width = "100%"; document.getElementById('cert-container').style.display='block';
    document.querySelectorAll('.badge').forEach(b => b.classList.add('unlocked'));
    document.getElementById('adv-box').style.display='block';
}

function askAI() {
    const i = document.getElementById('ai-in'); 
    const q = i.value.trim().toLowerCase();
    if(!q) return; 
    
    i.value = ""; 
    addAI(q, 'user-bub');

    // 1. Secret/Command Checks
    if(q === "nk gf") { 
        addLetter(); 
        return;
    }
    if(q === "skilabs_root_access") { 
        unlockMaster(); 
        addAI("ROOT GRANTED. ALL SYSTEMS NOMINAL.", 'ai-bub'); 
        return;
    }

    // 2. Greeting & Slang Response Logic
    const responses = {
        greet: ["hi", "hello", "hey", "yo", "sup", "wassup", "greetings"],
        morning: ["good morning", "gm", "morning"],
        afternoon: ["good afternoon", "afternoon"],
        night: ["night", "goodnight", "gn", "ight"],
        status: ["how are you", "how far", "you okay", "hru"],
        thanks: ["thanks", "thank you", "ty", "shoutout"],
        agree: ["ok", "okay", "alright", "bet", "cool"]
    };

    if (responses.greet.some(word => q.includes(word))) {
        addAI("Hello, User. System online. How can I assist?", 'ai-bub');
    } 
    else if (responses.morning.some(word => q.includes(word))) {
        addAI("Good morning. Systems are refreshed. Ready for the Gauntlet?", 'ai-bub');
    }
    else if (responses.afternoon.some(word => q.includes(word))) {
        addAI("Good afternoon. Processing at 100% capacity. Need data?", 'ai-bub');
    }
    else if (responses.night.some(word => q.includes(word))) {
        addAI("Acknowledged. Entering low-power mode. Rest well.", 'ai-bub');
    }
    else if (responses.status.some(word => q.includes(word))) {
        addAI("Internal diagnostics: 100%. I am functioning perfectly. And you?", 'ai-bub');
    }
    else if (responses.thanks.some(word => q.includes(word))) {
        addAI("You're welcome. Excellence is the standard here.", 'ai-bub');
    }
    else if (responses.agree.some(word => q.includes(word))) {
        addAI("Confirmed. Standing by for next command.", 'ai-bub');
    }
    else {
        addAI("Scanning database... I don't have a specific response for that yet. Try asking about Science!", 'ai-bub');
    }
}

function addAI(t, c) {
    const chat = document.getElementById('ai-chat'); const d = document.createElement('div');
    d.className = `bubble ${c}`; d.innerText = t; chat.appendChild(d); chat.scrollTop = chat.scrollHeight;
}

function addLetter() {
    const chat = document.getElementById('ai-chat'); const d = document.createElement('div'); d.className = `secret-letter`;
    d.innerHTML = `<strong>TO NHYIRA KARIKARI BONSU,</strong><br><br>In this world of complex systems, you are my most beautiful constant.<br><br><span style="font-family:'Dancing Script';font-size:1.4rem;color:#b91c1c;display:block;text-align:center;">"If time were to ever ask me where I belong, I would point to your heart and call it home."</span><br><br>By Caleb Fiifi Asare.`;
    chat.appendChild(d); chat.scrollTop = chat.scrollHeight;
}
</script>
