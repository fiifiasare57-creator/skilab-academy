<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SkiLabs | Academy Terminal</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&family=JetBrains+Mono:wght@400;700&family=Dancing+Script:wght@600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root { 
            --primary: #4f46e5; --accent: #06b6d4; --gold: #b45309; --bg: #ffffff; 
            --panel: #f8fafc; --border: #e2e8f0; --text: #1e293b; --subtext: #64748b; --sidebar-bg: #f1f5f9;
        }
        /* The Gold Transformation Theme */
        .gold-theme { 
            --primary: #d97706; --accent: #f59e0b; --bg: #fffcf0; --panel: #ffffff; --border: #fef3c7; --sidebar-bg: #fef3c7; --text: #451a03;
        }
        .dark-mode {
            --bg: #0f172a; --panel: #1e293b; --border: #334155; --text: #f8fafc; --subtext: #94a3b8; --sidebar-bg: #0f172a;
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; font-family: 'Outfit', sans-serif; background: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; transition: 0.5s ease; }
        
        #login-screen { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px; }
        #sidebar { width: 260px; background: var(--sidebar-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; transition: transform 0.3s; z-index: 4000; }
        #sidebar-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); z-index: 3999; }
        
        @media (max-width: 768px) { 
            #sidebar { position: fixed; height: 100%; transform: translateX(-100%); } 
            #sidebar.open { transform: translateX(0); } 
            #sidebar.open + #sidebar-overlay { display: block; } 
        }

        .menu-toggle { display: none; position: fixed; top: 15px; left: 15px; z-index: 3000; background: var(--primary); color: white; border: none; padding: 10px 15px; border-radius: 10px; font-weight: bold; }
        @media (max-width: 768px) { .menu-toggle { display: block; } }

        .nav-btn { padding: 14px; margin-bottom: 8px; border-radius: 14px; cursor: pointer; color: var(--subtext); border: 1px solid transparent; background: none; text-align: left; width: 100%; font-size: 0.95rem; font-weight: 600; display: flex; align-items: center; gap: 12px; transition: 0.2s; }
        .nav-btn.active { background: var(--primary); color: white; }
        
        #main { flex-grow: 1; overflow-y: auto; padding: 80px 20px 40px; }
        .view { display: none; max-width: 600px; margin: 0 auto; }
        .active-view { display: block; animation: fadeIn 0.3s ease-out; }
        
        .glass-panel { background: var(--panel); border: 1px solid var(--border); border-radius: 24px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .quiz-opt { width: 100%; padding: 16px; border: 2px solid var(--border); border-radius: 14px; background: var(--panel); color: var(--text); margin-bottom: 12px; cursor: pointer; text-align: left; font-weight: 600; }
        .opt-wrong { background: #fee2e2 !important; border-color: #ef4444 !important; color: #b91c1c; }
        .opt-correct { background: #dcfce7 !important; border-color: #22c55e !important; color: #166534; }
        
        .hidden-stage { display: none; border: 2px solid var(--gold); }
        .gold-unlocked .hidden-stage { display: block; animation: slideDown 0.5s ease; }

        #ai-toggle { position: fixed; bottom: 20px; right: 20px; background: var(--primary); color: white; width: 55px; height: 55px; border-radius: 50%; border: none; z-index: 3500; font-size: 1.5rem; }
        #ai-window { display: none; position: fixed; bottom: 85px; right: 15px; left: 15px; height: 60vh; max-width: 400px; margin: 0 auto; background: var(--panel); border-radius: 24px; border: 1px solid var(--border); flex-direction: column; overflow: hidden; z-index: 5000; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
        #ai-chat { flex-grow: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .bubble { padding: 12px 16px; border-radius: 18px; max-width: 85%; font-size: 0.9rem; }
        .ai-bub { background: var(--border); align-self: flex-start; }
        .user-bub { background: var(--primary); color: white; align-self: flex-end; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<audio id="bg-music" loop>
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-17.mp3" type="audio/mpeg">
</audio>

<div id="login-screen">
    <div class="glass-panel" style="text-align:center; width:100%; max-width:350px;">
        <h1 style="color:var(--primary); font-size: 2.5rem; margin-bottom: 0;">SkiLabs_</h1>
        <p style="color: var(--subtext); margin-bottom: 30px;">Initialize Terminal Session</p>
        <input type="text" id="username-input" placeholder="ACCESS KEY (NAME)" style="width:100%; padding:15px; border-radius:12px; border:2px solid var(--border); background:var(--bg); color:var(--text); text-align:center; font-weight: bold;">
        <button class="nav-btn" style="background:var(--primary); color:white; justify-content:center; margin-top:15px; height: 55px;" onclick="handleLogin()">ENTER SYSTEM</button>
    </div>
</div>

<button class="menu-toggle" onclick="toggleSidebar()">‚ò∞ MENU</button>

<nav id="sidebar">
    <div style="font-weight:900; font-size:1.6rem; color:var(--primary); margin-bottom:30px; margin-top:20px; text-align:center;">SkiLabs.</div>
    <button class="nav-btn active" onclick="nav('dash', this)"><span>üè†</span> Dash</button>
    <button class="nav-btn" onclick="nav('gauntlet', this)"><span>‚öîÔ∏è</span> Gauntlet</button>
    <button class="nav-btn" onclick="nav('glossary', this)"><span>üìñ</span> Archive</button>
    <button class="nav-btn" onclick="nav('settings', this)"><span>‚öôÔ∏è</span> Settings</button>
</nav>
<div id="sidebar-overlay" onclick="toggleSidebar()"></div>

<main id="main">
    <section id="dash" class="view active-view">
        <h1>Command Center</h1>
        <div class="glass-panel">
            <p><b>Operator:</b> <span id="id-val" style="color:var(--primary)">---</span></p>
            <p><b>Status:</b> <span id="rank-val">PROBATION</span></p>
            <div style="height:12px; background:var(--border); border-radius:10px; overflow:hidden; margin-top: 10px;"><div id="prog-bar" style="width:5%; height:100%; background:var(--primary); transition:1.5s cubic-bezier(0.4, 0, 0.2, 1);"></div></div>
        </div>
    </section>

    <section id="gauntlet" class="view">
        <h1>The Gauntlet</h1>
        <div id="quiz-menu">
            <p style="color: var(--subtext); margin-bottom: 20px;">Complete Elite stage to unlock advanced levels.</p>
            <button class="quiz-opt" onclick="prepareQuiz('Pro')">STAGE 1: PRO</button>
            <button class="quiz-opt" onclick="prepareQuiz('Master')">STAGE 2: MASTER</button>
            <button class="quiz-opt" onclick="prepareQuiz('Elite')">STAGE 3: ELITE</button>
            
            <div id="gold-stages" class="hidden-stage">
                <button class="quiz-opt" style="border-color: var(--gold);" onclick="prepareQuiz('Ruby')">STAGE 4: RUBY</button>
                <button class="quiz-opt" style="border-color: var(--gold);" onclick="prepareQuiz('Emerald')">STAGE 5: EMERALD</button>
                <button class="quiz-opt" style="background: var(--gold); color: white;" onclick="prepareQuiz('Gold')">FINAL: GOLD MASTER</button>
            </div>
        </div>

        <div id="quiz-active" style="display:none;">
            <div class="glass-panel">
                <div style="display:flex; justify-content:space-between; margin-bottom:15px; font-size:0.85rem; font-weight: bold; color:var(--subtext);">
                    <span id="q-count">Q: 1/10</span>
                    <span id="q-score">Score: 0</span>
                </div>
                <p id="q-txt" style="font-weight:700; font-size:1.2rem; line-height: 1.4;"></p>
                <div id="q-opts"></div>
            </div>
        </div>

        <div id="score-screen" style="display:none; text-align:center;">
            <div class="glass-panel">
                <h2 id="score-status">STAGE COMPLETE</h2>
                <div id="final-score-display" style="font-size:4.5rem; font-weight:900; color:var(--primary); margin:10px 0;">0/10</div>
                <p id="score-msg" style="margin-bottom: 25px; color: var(--subtext);"></p>
                <button class="nav-btn" style="background:var(--primary); color:white; justify-content:center;" onclick="closeQuiz()">CONTINUE</button>
            </div>
        </div>
    </section>

    <section id="glossary" class="view">
        <h1>Data Archive</h1>
        <div id="glos-list"></div>
    </section>

    <section id="settings" class="view">
        <h1>Settings</h1>
        <div class="glass-panel">
            <button class="quiz-opt" onclick="toggleDarkMode()">üåì Dark Mode</button>
            <button class="quiz-opt" id="music-btn" onclick="toggleMusic()">üéµ Music Player</button>
            <button class="quiz-opt" style="color:#ef4444;" onclick="location.reload()">Reset Session</button>
        </div>
    </section>

    <footer style="text-align: center; padding: 60px 20px; color: var(--subtext); font-family: 'JetBrains Mono'; font-size: 0.75rem; letter-spacing: 1px;">
        DESIGNED BY CALEB FIIFI ASARE
    </footer>
</main>

<button id="ai-toggle" onclick="toggleAI()">üß†</button>
<div id="ai-window">
    <div style="background:var(--primary); color:white; padding:15px; display:flex; justify-content:space-between; align-items: center;">
        <b style="letter-spacing: 1px;">OMNI_AI</b> <span onclick="toggleAI()" style="cursor:pointer; font-size: 1.2rem;">‚úï</span>
    </div>
    <div id="ai-chat"></div>
    <div style="padding:15px; display:flex; gap:8px; border-top:1px solid var(--border);">
        <input type="text" id="ai-in" placeholder="System query..." style="flex:1; padding:12px; border-radius:12px; border:1px solid var(--border); background:var(--bg); color:var(--text);">
        <button onclick="askAI()" style="background:var(--primary); color:white; border:none; width: 45px; border-radius:12px;">‚û§</button>
    </div>
</div>

<script>
    let user = "";
    let isPlaying = false;
    let currentLvl = "";
    let qIdx = 0;
    let score = 0;
    let activeQuestions = [];
    let isGoldUnlocked = false;

    const facts = [
        "Light takes 8 minutes and 20 seconds to travel from the Sun to Earth.", "A teaspoon of a neutron star would weigh 6 billion tons.", "Venus rotates clockwise, unlike most other planets.", "There are more trees on Earth than stars in the Milky Way.", "Water can boil and freeze at the same time at its 'triple point'.",
        "Octopuses have three hearts and blue blood.", "Honey never spoils; archaeologists found edible 3,000-year-old honey.", "Bananas are slightly radioactive because they contain potassium.", "A day on Venus is longer than its year.", "The footprints on the Moon will stay there for millions of years.",
        "Your DNA could stretch from the Earth to Pluto and back 17 times.", "The Eiffel Tower can be 15cm taller during summer due to heat expansion.", "Sharks have been around longer than trees.", "A bolt of lightning is 5 times hotter than the Sun's surface.", "Humans share 50% of their DNA with bananas.",
        "Saturn would float if you put it in a giant bathtub of water.", "Plastic takes about 450 years to decompose in the ocean.", "There is enough gold in Earth's core to coat the entire surface.", "Clouds can weigh over a million pounds.", "A single solar flare can release the energy of millions of hydrogen bombs.",
        "The world's oldest known living tree is over 4,800 years old.", "Antarctica is the largest desert on Earth.", "Sound travels 4 times faster in water than in air.", "Koalas have fingerprints almost identical to humans.", "The heart of a shrimp is located in its head.",
        "An ostrich's eye is bigger than its brain.", "Rats laugh when they are tickled.", "The smell of rain is caused by bacteria called Actinomycetes.", "Glass is actually a slow-moving liquid.", "The human eye can distinguish 10 million different colors.",
        "There are 206 bones in an adult human body.", "Jupiter's Great Red Spot is a storm larger than Earth.", "Diamond is the hardest natural substance.", "Wombat poop is cube-shaped.", "Turtles can breathe through their butts.",
        "A group of flamingos is called a 'flamboyance'.", "Sea otters hold hands while sleeping to stay together.", "Cows have best friends and get stressed when separated.", "The longest recorded flight of a chicken is 13 seconds.", "A snail can sleep for up to three years.",
        "Butterflies taste with their feet.", "The total weight of all ants on Earth is roughly equal to all humans.", "A blue whale's tongue weighs as much as an elephant.", "Earth is the only planet not named after a god.", "Your heart beats about 100,000 times a day.",
        "Stomach acid can dissolve metal.", "A jiffy is an actual unit of time (1/100th of a second).", "The most common element in the universe is Hydrogen.", "Rubber bands last longer when refrigerated.", "Venus is the hottest planet in our solar system."
    ];

    const quizzes = {
        Pro: [
            {q:"What is the chemical symbol for Gold?", a:"Au", o:["Ag","Fe","Gd"]}, {q:"Which planet is known as the Red Planet?", a:"Mars", o:["Venus","Saturn","Jupiter"]}, {q:"What is the hardest natural substance on Earth?", a:"Diamond", o:["Gold","Iron","Quartz"]}, {q:"What is the chemical formula for water?", a:"H2O", o:["HO2","CO2","NaCl"]}, {q:"Which gas do humans need to breathe to live?", a:"Oxygen", o:["Nitrogen","Helium","Carbon"]},
            {q:"How many planets are in our solar system?", a:"8", o:["9","7","10"]}, {q:"What is often called the 'powerhouse' of the cell?", a:"Mitochondria", o:["Nucleus","DNA","Ribosome"]}, {q:"Which is the largest ocean on Earth?", a:"Pacific", o:["Atlantic","Indian","Arctic"]}, {q:"What is the boiling point of water in Celsius?", a:"100¬∞C", o:["90¬∞C","120¬∞C","80¬∞C"]}, {q:"What is the largest land animal?", a:"Elephant", o:["Giraffe","Rhino","Hippo"]}
        ],
        Master: [
            {q:"What is the approximate speed of light?", a:"300,000 km/s", o:["150,000 km/s","500,000 km/s","10,000 km/s"]}, {q:"How many bones are in an adult human body?", a:"206", o:["200","210","300"]}, {q:"What is absolute zero in Celsius?", a:"-273.15", o:["0","-100","-400"]}, {q:"Which of these is a noble gas?", a:"Neon", o:["Oxygen","Nitrogen","Chlorine"]}, {q:"What is the center of an atom called?", a:"Nucleus", o:["Proton","Electron","Shell"]},
            {q:"78% of Earth's atmosphere is made of what gas?", a:"Nitrogen", o:["Oxygen","Argon","CO2"]}, {q:"What is the unit of electrical resistance?", a:"Ohm", o:["Volt","Watt","Amp"]}, {q:"Which metal is liquid at room temperature?", a:"Mercury", o:["Lead","Iron","Gallium"]}, {q:"What is the atomic number of Carbon?", a:"6", o:["12","8","1"]}, {q:"Who is credited with discovering gravity?", a:"Newton", o:["Einstein","Tesla","Galileo"]}
        ],
        Elite: [
            {q:"What is the pH level of pure water?", a:"7", o:["1","14","5"]}, {q:"What is the smallest basic unit of life?", a:"Cell", o:["Atom","Molecule","Tissue"]}, {q:"Most abundant gas in the universe?", a:"Hydrogen", o:["Oxygen","Helium","Nitrogen"]}, {q:"What is the scientific study of fungi?", a:"Mycology", o:["Botany","Zoology","Biology"]}, {q:"What is the electrical charge of a neutron?", a:"Neutral", o:["Positive","Negative","Variable"]},
            {q:"Which is the closest star to Earth?", a:"Sun", o:["Proxima Centauri","Sirius","Vega"]}, {q:"Process by which plants make food?", a:"Photosynthesis", o:["Respiration","Osmosis","Diffusion"]}, {q:"What is the largest organ in the human body?", a:"Skin", o:["Liver","Brain","Heart"]}, {q:"What is the SI unit of power?", a:"Watt", o:["Joule","Volt","Newton"]}, {q:"What is the deepest known point in the ocean?", a:"Mariana Trench", o:["Java Trench","Arctic Basin","Dead Sea"]}
        ],
        Ruby: [
            {q:"What is the rarest human blood type?", a:"AB Negative", o:["O Negative","A Positive","B Negative"]}, {q:"Distance light travels in a year?", a:"9.46 trillion km", o:["1 million km","1 trillion km","500 billion km"]}, {q:"Who is the 'Father of Genetics'?", a:"Mendel", o:["Darwin","Watson","Crick"]}, {q:"Which planet has the most moons?", a:"Saturn", o:["Jupiter","Uranus","Mars"]}, {q:"What is the speed of sound in air?", a:"343 m/s", o:["299 m/s","500 m/s","100 m/s"]},
            {q:"Approximate molar mass of water?", a:"18.015 g/mol", o:["16 g/mol","1 g/mol","12 g/mol"]}, {q:"Gas used in incandescent bulbs?", a:"Argon", o:["Neon","Oxygen","Hydrogen"]}, {q:"Which is the densest planet?", a:"Earth", o:["Jupiter","Mars","Saturn"]}, {q:"How many legs do spiders have?", a:"8", o:["6","10","12"]}, {q:"What gives plants their green color?", a:"Chlorophyll", o:["Red","Blue","Yellow"]}
        ],
        Emerald: [
            {q:"What is the value of the Golden Ratio?", a:"1.618", o:["3.141","2.718","1.414"]}, {q:"Half-life of Carbon-14?", a:"5730 years", o:["1000 years","10000 years","500 years"]}, {q:"Main acid found in lemons?", a:"Citric", o:["Acetic","Lactic","Nitric"]}, {q:"Largest hot desert in the world?", a:"Sahara", o:["Gobi","Kalahari","Atacama"]}, {q:"Vitamin essential for blood clotting?", a:"Vitamin K", o:["Vitamin C","Vitamin D","Vitamin A"]},
            {q:"Elements in the Periodic Table?", a:"118", o:["115","120","100"]}, {q:"Gas to liquid transformation?", a:"Condensation", o:["Evaporation","Sublimation","Melting"]}, {q:"Newton's 1st Law is the Law of?", a:"Inertia", o:["Gravity","Friction","Momentum"]}, {q:"Main component of glass?", a:"Silica", o:["Sodium","Calcium","Carbon"]}, {q:"Which bird can fly backwards?", a:"Hummingbird", o:["Sparrow","Eagle","Parrot"]}
        ],
        Gold: [
            {q:"Most abundant element in Earth's crust?", a:"Oxygen", o:["Silicon","Iron","Aluminum"]}, {q:"Which planet has a day longer than its year?", a:"Venus", o:["Mars","Mercury","Jupiter"]}, {q:"Human body's largest internal organ?", a:"Liver", o:["Heart","Lung","Brain"]}, {q:"Temperature where C and F are equal?", a:"-40", o:["0","32","-273"]}, {q:"Who developed the polio vaccine?", a:"Jonas Salk", o:["Louis Pasteur","Alexander Fleming","Marie Curie"]},
            {q:"What type of galaxy is the Milky Way?", a:"Spiral", o:["Elliptical","Irregular","Lenticular"]}, {q:"What is the study of weather called?", a:"Meteorology", o:["Geology","Astronomy","Ecology"]}, {q:"Smallest planet in the solar system?", a:"Mercury", o:["Mars","Pluto","Venus"]}, {q:"What is the primary gas on Jupiter?", a:"Hydrogen", o:["Helium","Methane","Oxygen"]}, {q:"Who proposed the theory of Relativity?", a:"Einstein", o:["Newton","Hawking","Bohr"]}
        ]
    };

    function toggleMusic() {
        const music = document.getElementById('bg-music');
        const btn = document.getElementById('music-btn');
        isPlaying ? music.pause() : music.play();
        btn.innerText = isPlaying ? "üéµ Music Player" : "üîá Stop Music";
        isPlaying = !isPlaying;
    }

    function toggleDarkMode() { document.body.classList.toggle('dark-mode'); }

    function handleLogin() {
        const inp = document.getElementById('username-input');
        if(!inp.value) return;
        user = inp.value.trim().toUpperCase();
        document.getElementById('id-val').innerText = user;
        document.getElementById('login-screen').style.display = 'none';
        renderArchive();
    }

    function nav(id, btn) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active-view'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active-view');
        btn.classList.add('active');
        if(window.innerWidth <= 768) toggleSidebar();
    }

    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }

    function renderArchive() {
        const list = document.getElementById('glos-list');
        list.innerHTML = "";
        facts.forEach((f, i) => {
            const card = document.createElement('div');
            card.className = "archive-card";
            card.innerHTML = `<small style="opacity: 0.6;">ENTRY_ID_${i+1}</small><p style="margin: 5px 0 0 0; font-weight: 500;">${f}</p>`;
            list.appendChild(card);
        });
    }

    function prepareQuiz(lvl) {
        currentLvl = lvl; qIdx = 0; score = 0;
        activeQuestions = quizzes[lvl];
        document.getElementById('quiz-menu').style.display = 'none';
        document.getElementById('quiz-active').style.display = 'block';
        showQuestion();
    }

    function showQuestion() {
        const q = activeQuestions[qIdx];
        document.getElementById('q-count').innerText = `QUESTION: ${qIdx + 1}/10`;
        document.getElementById('q-score').innerText = `SCORE: ${score}`;
        document.getElementById('q-txt').innerText = q.q;
        const box = document.getElementById('q-opts');
        box.innerHTML = "";
        const options = [...q.o, q.a].sort(() => Math.random() - 0.5);
        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = "quiz-opt";
            btn.innerText = opt;
            btn.onclick = () => checkAns(btn, opt === q.a);
            box.appendChild(btn);
        });
    }

    function checkAns(btn, isCorrect) {
        const btns = document.querySelectorAll('.quiz-opt');
        btns.forEach(b => b.style.pointerEvents = 'none');
        if(isCorrect) { btn.classList.add('opt-correct'); score++; }
        else { btn.classList.add('opt-wrong'); }
        
        setTimeout(() => {
            qIdx++;
            if(qIdx < 10) showQuestion();
            else finishQuiz();
        }, 800);
    }

    function finishQuiz() {
        document.getElementById('quiz-active').style.display = 'none';
        document.getElementById('score-screen').style.display = 'block';
        document.getElementById('final-score-display').innerText = `${score}/10`;
        
        if(score >= 7) {
            document.getElementById('score-status').innerText = "STAGE CLEARED!";
            document.getElementById('score-msg').innerText = "Advancement authorized. Data updated.";
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            
            // Logic for unlocking Gold Stages
            if(currentLvl === 'Elite') {
                isGoldUnlocked = true;
                document.body.classList.add('gold-theme');
                document.getElementById('gauntlet').classList.add('gold-unlocked');
                document.getElementById('rank-val').innerText = "ELITE (GOLD UNLOCKED)";
                document.getElementById('prog-bar').style.width = "60%";
            } else if (isGoldUnlocked) {
                document.getElementById('rank-val').innerText = currentLvl.toUpperCase() + " OPERATOR";
                let progress = currentLvl === 'Ruby' ? 75 : (currentLvl === 'Emerald' ? 90 : 100);
                document.getElementById('prog-bar').style.width = progress + "%";
            }
        } else {
            document.getElementById('score-status').innerText = "STAGE FAILED";
            document.getElementById('score-msg').innerText = "Insufficient data points. Minimum 7/10 required.";
        }
    }

    function closeQuiz() {
        document.getElementById('score-screen').style.display = 'none';
        document.getElementById('quiz-menu').style.display = 'block';
    }

    function toggleAI() { 
        const w = document.getElementById('ai-window'); 
        w.style.display = w.style.display === 'flex' ? 'none' : 'flex'; 
    }

    function askAI() {
        const i = document.getElementById('ai-in');
        const chat = document.getElementById('ai-chat');
        const query = i.value.toLowerCase().trim();
        if(!query) return;

        let reply = "";
        if(query === "nk gf") {
            reply = `<div class="bubble ai-bub" style="background:#fff7ed; border:1px solid #fed7aa; color:#9a3412;">
                <strong>TO NHYIRA KARIKARI BONSU,</strong><br><br>
                In this world of complex systems, you are my most beautiful constant. If time were to ever ask me where I belong, I would point to your heart.<br><br>
                <span style="font-family:'Dancing Script'; font-size:1.4rem;">- Caleb Fiifi Asare</span>
            </div>`;
        } else {
            reply = `<div class="bubble ai-bub">System response for "${query}": Access denied. Try authorized codes like "nk gf".</div>`;
        }
        
        chat.innerHTML += `<div class="bubble user-bub">${i.value}</div>` + reply;
        i.value = "";
        chat.scrollTop = chat.scrollHeight;
    }
</script>
</body>
</html>
